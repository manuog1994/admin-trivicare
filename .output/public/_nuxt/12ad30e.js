(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{646:function(t,e,r){"use strict";r.r(e);r(18),r(13),r(2),r(0),r(133),r(4),r(6),r(3),r(7);var o=r(24),n=r(11),c=(r(51),r(5),r(76),r(81),r(554)),d=r.n(c);function l(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}var v={data:function(){return{id:this.$route.params.id,order:{},productsOrder:[],products:[],addProduct:"",post_shipping:0,total:0}},mounted:function(){this.getOrder(),this.getProducts()},methods:{getOrder:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.$root.$emit("loading",!0),e.next=3,t.$axios.get("/api/orders?filter[id]="+t.id).then((function(e){t.$root.$emit("loading",!1),e.data.data.map((function(e){e.id==t.id&&(t.order=e,t.productsOrder=JSON.parse(e.products))}))})).catch((function(e){t.$root.$emit("loading",!1)}));case 3:case"end":return e.stop()}}),e)})))()},getProducts:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.$root.$emit("loading",!0),e.next=3,t.$axios.get("/api/products").then((function(e){t.$root.$emit("loading",!1),t.products=e.data.data})).catch((function(e){t.$root.$emit("loading",!1)}));case 3:case"end":return e.stop()}}),e)})))()},addUpdateProduct:function(){var t=this.$refs.selectProduct,e=this.products.find((function(e){return e.id==t.value})),r=this.productsOrder.find((function(e){return e.id==t.value}));r?(r.cartQuantity+=1,r.total=r.cartQuantity*r.price_base):(e.cartQuantity=1,e.total=e.cartQuantity*e.price_base,this.productsOrder.push(function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},e)))},incremetProduct:function(t){console.log(t),t.cartQuantity+=1,t.total=t.cartQuantity*t.price_base},decrementProduct:function(t){t.cartQuantity>1?(t.cartQuantity-=1,t.total=t.cartQuantity*t.price_base):this.deleteProduct(t)},deleteProduct:function(t){var e=this.productsOrder.indexOf(t);this.productsOrder.splice(e,1)},getTotal:function(){var t=this.productsOrder.reduce((function(t,e){return t+e.total}),0);return this.total=t,1.21*t<40?(1.21*t+parseFloat(this.order.shipping)+parseFloat(this.post_shipping)).toFixed(2):(1.21*t).toFixed(2)},sendModifications:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d.a.fire({title:"¿Estás seguro de que quieres guardar los cambios?",text:"¡Se borrará la factura anterior y se enviara la rectificada al cliente!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Sí, actualizar!"}).then(function(){var e=Object(n.a)(regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isConfirmed){e.next=4;break}return t.$root.$emit("loading",!0),e.next=4,t.$axios.put("/api/order-modification",{id:t.id,products:JSON.stringify(t.productsOrder),total:t.getTotal(),shipping:0==t.post_shipping?t.order.shipping:t.post_shipping}).then((function(e){t.$root.$emit("loading",!1),d.a.fire({icon:"success",title:"¡Modificación realizada!",showConfirmButton:!1,timer:1500}),t.getOrder()})).catch((function(e){t.$root.$emit("loading",!1),console.log(e)}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))()}}},_=v,f=r(68),component=Object(f.a)(_,(function(){var t,e,r,o,n,c,d,l,v=this,_=v._self._c;return _("div",{staticClass:"main"},[_("div",{staticClass:"row mt-4 mb-2"},[v._m(0),v._v(" "),_("div",[_("p",{staticClass:"m-0"},[v._v("Nombre del cliente: "),_("strong",[v._v(v._s("Guest"==(null===(t=v.order.user_profile)||void 0===t?void 0:t.name)?null===(e=v.order.guest)||void 0===e?void 0:e.name:null===(r=v.order.user_profile)||void 0===r?void 0:r.name)+" "+v._s("Guest"==(null===(o=v.order.user_profile)||void 0===o?void 0:o.lastname)?null===(n=v.order.guest)||void 0===n?void 0:n.lastname:null===(c=v.order.user_profile)||void 0===c?void 0:c.lastname))])]),v._v(" "),_("p",{staticClass:"m-0"},[v._v("Id pedido: "),_("strong",[v._v(v._s(v.order.id))])]),v._v(" "),null!==(d=v.order.invoice)&&void 0!==d&&d.id?_("p",{staticClass:"m-0"},[v._v("Factura: "),_("strong",[v._v(v._s(null===(l=v.order.invoice)||void 0===l?void 0:l.invoice_number))])]):v._e()])]),v._v(" "),_("div",{staticClass:"row"},[_("div",{staticClass:"col-12"},[v._m(1),v._v(" "),_("div",{staticClass:"mt-4"},[_("table",{staticClass:"table"},[v._m(2),v._v(" "),v.productsOrder.length>0?_("tbody",v._l(v.productsOrder,(function(t){return _("tr",{key:t.id},[_("td",[v._v(v._s(t.name))]),v._v(" "),_("td",[_("div",{staticClass:"row"},[_("div",{staticClass:"col-12"},[_("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button",id:"button-minus"},on:{click:function(e){return v.decrementProduct(t)}}},[v._v("-")]),v._v(" "),_("span",{staticClass:"p-2 border"},[v._v(v._s(t.cartQuantity))]),v._v(" "),_("button",{staticClass:"btn btn-outline-secondary",attrs:{type:"button",id:"button-plus"},on:{click:function(e){return v.incremetProduct(t)}}},[v._v("+")])])])]),v._v(" "),_("td",[v._v(v._s(t.price))]),v._v(" "),_("td",[_("button",{staticClass:"btn bg-trivi-red text-white",on:{click:function(e){return v.deleteProduct(t)}}},[_("i",{staticClass:"fa fa-trash"})])])])})),0):v._e()])])]),v._v(" "),_("div",[v.order.coupon?_("div",{staticClass:"d-flex justify-content-end"},[_("h5",[v._v("Descuento: "+v._s(v.order.coupon))])]):v._e(),v._v(" "),v.order.shipping&&0==v.post_shipping?_("div",{staticClass:"d-flex justify-content-end"},[_("h5",[v._v("Envio: "+v._s(v.getTotal()>40?"Gratis":v.order.shipping))])]):v._e(),v._v(" "),v.getTotal()<40&&0==v.order.shipping&&"pickup-point"!=v.order.shipping_method?_("div",{staticClass:"mb-2"},[_("label",{attrs:{for:""}},[v._v("Seleccione el envío:")]),v._v(" "),_("select",{directives:[{name:"model",rawName:"v-model",value:v.post_shipping,expression:"post_shipping"}],ref:"selectStatus",staticClass:"form-select",attrs:{name:"selectStatus"},on:{change:function(t){var e=Array.prototype.filter.call(t.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));v.post_shipping=t.target.multiple?e:e[0]}}},[_("option",{attrs:{value:"0",disabled:"",selected:""}},[v._v("Seleccione un envío")]),v._v(" "),_("option",{attrs:{value:"4.95"}},[v._v("Estándar 4.95 €")]),v._v(" "),_("option",{attrs:{value:"5.95"}},[v._v("Rápido 5.95 €")]),v._v(" "),_("option",{attrs:{value:"6.95"}},[v._v("Urgente 6.95 €")])])]):v._e(),v._v(" "),_("div",{staticClass:"d-flex justify-content-end"},[_("h4",[v._v("Total: "+v._s("NaN"==v.getTotal()?(1.21*v.order.total).toFixed(2):v.getTotal()))])])]),v._v(" "),_("div",{staticClass:"col-12"},[v._m(3),v._v(" "),_("div",[_("div",{staticClass:"mb-3"},[_("select",{ref:"selectProduct",staticClass:"form-select",attrs:{name:"selectProduct"}},[_("option",{attrs:{value:"0",disabled:"",selected:""}},[v._v("Seleccione un producto")]),v._v(" "),v._l(v.products,(function(t){return _("option",{key:t.id,domProps:{value:t.id}},[v._v(v._s(t.name))])}))],2)]),v._v(" "),_("div",{staticClass:"d-flex justify-content-end"},[_("button",{staticClass:"btn bg-trivi-green",on:{click:v.addUpdateProduct}},[v._v("Añadir producto")])])])]),v._v(" "),_("div",{staticClass:"col-12 mt-4"},[v._m(4),v._v(" "),_("div",{staticClass:"d-flex justify-content-center mt-4"},[_("button",{staticClass:"btn bg-trivi-blue",on:{click:v.sendModifications}},[v._v("Actualizar pedido")])])])])])}),[function(){var t=this._self._c;return t("div",{staticClass:"col-12"},[t("h3",[this._v("Editar Pedido")])])},function(){var t=this._self._c;return t("div",{staticClass:"mt-2"},[t("h4",[this._v("\n                    Productos del pedido actual\n                ")])])},function(){var t=this,e=t._self._c;return e("thead",[e("tr",[e("th",{attrs:{scope:""}},[t._v("Producto")]),t._v(" "),e("th",{attrs:{scope:""}},[t._v("Cantidad")]),t._v(" "),e("th",{attrs:{scope:""}},[t._v("Precio")]),t._v(" "),e("th",{attrs:{scope:""}},[t._v("Acciones")])])])},function(){var t=this._self._c;return t("div",{staticClass:"mb-2"},[t("h4",[this._v("Productos")])])},function(){var t=this._self._c;return t("div",{staticClass:"text-center text-bg-danger rounded shadow p-3"},[t("p",{staticClass:"text-white"},[this._v("Antes de confirmar el pedido revisa que el total que se muestra es el correcto, ya que el pedido se generará con ese monto. Si no es así pulsa en cambia la cantidad del primer producto con los botones y vuelve a dejarlo como estaba anteriormente, esto actualizará la variable del total.")])])}],!1,null,null,null);e.default=component.exports}}]);